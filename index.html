<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Dreamless Kingdom – Flora Archive</title>
  <meta name="description" content="A living archive that tracks flora across the Dreamless Kingdom."/>
  <link rel="stylesheet" href="assets/style.css"/>
</head>
<body>
  <div class="spore-particles" id="sporeContainer" aria-hidden="true"></div>

  <div class="container">
    <header class="hero">
      <h1>DREAMLESS KINGDOM</h1>
      <div class="subtitle">Flora Archive &amp; Living Field Notes</div>
    </header>

    <nav class="nav-tabs" role="tablist" aria-label="Archive sections">
      <button id="tab-overview" class="tab active" data-section="overview" type="button" role="tab" aria-selected="true">Overview</button>
      <button id="tab-atlas" class="tab" data-section="atlas" type="button" role="tab" aria-selected="false">Atlas Overlay</button>
      <button id="tab-catalogue" class="tab" data-section="catalogue" type="button" role="tab" aria-selected="false">Specimen Catalogue</button>
    </nav>

    <main>
      <section id="overview" class="content-section active" role="tabpanel" aria-labelledby="tab-overview">
        <p class="section-intro">The flora of the Dreamless Kingdom remembers a time before the Palace rationed wonder. Spores weave memories between villages, and every bloom is a witness. This archive keeps their stories in motion while a lone surveyor charts the forgotten growth.</p>

        <div class="timeline">
          <article class="timeline-item">
            <div class="timeline-date">Before the Silence</div>
            <h3>Dream Gardens Flourish</h3>
            <p>Collective gardens coaxed new species from shared reverie. These specimens shaped districts, guiding pilgrim paths by colour and scent.</p>
          </article>
          <article class="timeline-item">
            <div class="timeline-date">The Extraction Age</div>
            <h3>Palace Catalogues Desire</h3>
            <p>Expeditions stripped the woods for proprietary spores. Villagers hid what they could, swearing botanists to secrecy as memory-taxation began.</p>
          </article>
          <article class="timeline-item">
            <div class="timeline-date">Surveyor's Watch</div>
            <h3>A Living Archive</h3>
            <p>The lone observer now transcribes blooms in transit, syncing each discovery to this ledger. Your search reshapes where they wander next.</p>
          </article>
        </div>

        <div class="dialogue-box">
          <div class="dialogue-character">The Oracle</div>
          <div class="dialogue-text">"I saw someone tend the spores instead of hoarding them. Help the surveyor keep the archive breathing and the Kingdom might remember how to dream again."</div>
        </div>
      </section>

      <section id="atlas" class="content-section" role="tabpanel" aria-labelledby="tab-atlas">
        <div class="map-atlas">
          <section class="map-panel" aria-label="Interactive flora map">
            <div class="map-header">
              <h2>Flora Atlas Overlay</h2>
              <p>Markers glow when a specimen matches your current search. Click any marker to open the full entry.</p>
              <div id="variant-cycle" class="map-variant" aria-live="polite"></div>
            </div>
            <div id="map" class="map" role="img" aria-label="Stylised map of the Dreamless Kingdom with flora markers"></div>
            <div class="map-legend small">
              <span class="legend-item"><span class="legend-dot"></span> Discoverable specimen</span>
              <span class="legend-item"><span class="legend-dot character"></span> NPC contact</span>
              <span class="legend-item"><span class="legend-dot npc-new"></span> NPC with new dialogue</span>
              <span class="legend-item"><span class="legend-dot dim"></span> Outside current filters</span>
            </div>
          </section>

          <section class="observer-panel" aria-live="polite" aria-label="Automated expedition tracker">
            <div class="panel-header">
              <h2>Expedition Observer</h2>
              <p>A lone surveyor roams the Dreamless Kingdom, collecting flora samples for the archive. Watch their progress and browse the catalogue at your leisure.</p>
            </div>
            <div class="observer-body">
              <div class="observer-stats">
                <div class="tally">Samples secured: <strong id="explorer-count">0</strong></div>
                <div id="explorer-status" class="small muted">Surveyor calibrating instruments…</div>
              </div>
              <div class="observer-scene" aria-live="polite">
                <div class="scene-label">Field conditions</div>
                <div id="observer-scene" class="scene-status muted">No anomalies detected.</div>
              </div>
              <ol id="explorer-log" class="observer-log" aria-label="Recent specimens catalogued"></ol>
            </div>
          </section>
        </div>
      </section>

      <section id="catalogue" class="content-section" role="tabpanel" aria-labelledby="tab-catalogue">
        <div class="catalogue-toolbar">
          <div class="controls">
            <input id="q" type="search" placeholder="Search titles and summaries… (press /)" />
            <button id="export" title="Export current view as JSON">Export JSON</button>
          </div>
          <div class="controls" id="tags" role="group" aria-label="Filter by tag"></div>
          <div class="stats">Showing <span id="count">0/0</span></div>
        </div>

        <section id="grid" class="grid" aria-live="polite"></section>
      </section>
    </main>

    <footer class="footer">v0.3 • Flora archive • Data: <code>data/entries.json</code></footer>
  </div>

  <div id="modal" class="modal" role="dialog" aria-modal="true" aria-label="Entry detail">
    <article class="sheet">
      <header>
        <strong>Entry</strong>
        <div class="right">
          <span class="small">Press <kbd>Esc</kbd> to close</span>
          <button id="close" aria-label="Close">Close</button>
        </div>
      </header>
      <div class="body"></div>
    </article>
  </div>

  <script>
    window.addEventListener('keydown', (e)=>{
      if(e.key === '/' && document.activeElement.tagName !== 'INPUT'){
        e.preventDefault();
        const search = document.getElementById('q');
        if(search){ search.focus(); }
      }
      if(e.key === 'Escape'){
        const m = document.getElementById('modal');
        if(m.classList.contains('open')) document.getElementById('close').click();
      }
    });
  </script>
  <script>
    (function(){
      const tabs = document.querySelectorAll('.nav-tabs .tab');
      const sections = document.querySelectorAll('.content-section');

      function activateSection(id){
        tabs.forEach((tab)=>{
          const match = tab.dataset.section === id;
          tab.classList.toggle('active', match);
          tab.setAttribute('aria-selected', String(match));
        });
        sections.forEach((section)=>{
          section.classList.toggle('active', section.id === id);
        });
        if(!location.hash.startsWith('#/item/')){
          history.replaceState(null, '', '#' + id);
        }
      }

      tabs.forEach((tab)=>{
        tab.addEventListener('click', ()=> activateSection(tab.dataset.section));
        tab.addEventListener('keydown', (e)=>{
          if(e.key === 'Enter' || e.key === ' '){
            e.preventDefault();
            activateSection(tab.dataset.section);
          }
        });
      });

      const hash = location.hash.replace('#','');
      if(hash && !hash.startsWith('/item/')){
        const target = document.getElementById(hash);
        if(target){ activateSection(hash); }
      }

      const sporeContainer = document.getElementById('sporeContainer');
      if(sporeContainer){
        const count = Math.min(Math.floor(window.innerWidth * window.innerHeight / 16000), 140);
        for(let i = 0; i < count; i++){
          const spore = document.createElement('div');
          spore.className = 'spore';
          spore.style.left = Math.random() * 100 + 'vw';
          spore.style.top = Math.random() * 100 + 'vh';
          spore.style.animationDuration = (18 + Math.random() * 20) + 's';
          spore.style.animationDelay = (-Math.random() * 20) + 's';
          sporeContainer.appendChild(spore);
        }
      }
    })();
  </script>
  <script src="assets/app.js"></script>
</body>
</html>
